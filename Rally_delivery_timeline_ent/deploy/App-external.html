<!DOCTYPE html>
<html>
<head>
    <title>delivery_timeline_ent</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                function binarySearch(t,e,a){for(var o=0,r=t.length-1;o<=r;){var i=Math.floor((o+r)/2),n=t[i].raw[e];if(n===a)return i;a<n?o=i+1:r=i-1}return-1}function convertCADateZ(t){var e=Number(t.substring(5,7))-1,a=Number(t.substring(0,4)),o=Number(t.substring(8,10));return"59:59.000Z"===t.substring(14,t.length)&&1===o&&(0===e?(a--,e=11):e--),new Date(a,e,1)}function searchKeyPair(t,e,a){for(var o=0;o<t.length;o++)if(t[o][e]===a)return o;return-1}Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",items:[{xtype:"container",itemId:"myContainer-id",layout:{type:"hbox",align:"stretch"},width:"100%",border:15}],launch:function(){this.setLoading("Processing - Please wait ..."),this.start_time=(new Date).getTime(),this._detectClientBrowser(),this._init(),this._loadTagChooser(),this._loadPortfolioData()},_detectClientBrowser:function(){var t=this;t.isFirefox="undefined"!=typeof InstallTrigger,t.isIE=!!document.documentMode,t.isEdge=!t.isIE&&!!window.StyleMedia,t.isChrome=!!window.chrome&&!!window.chrome.webstore,t.isBlink=(t.isChrome||t.isOpera)&&!!window.CSS;var e="Detecting browsers by ducktyping:<hr>";e+="isFirefox: "+t.isFirefox+"\n",e+="isChrome: "+t.isChrome+"\n",e+="isSafari: "+t.isSafari+"\n",e+="isOpera: "+t.isOpera+"\n",e+="isIE: "+t.isIE+"\n",e+="isEdge: "+t.isEdge+"\n",e+="isBlink: "+t.isBlink+"\n",console.log(e)},_init:function(){this.mbi_data_table=[],this.legend={"No Entry":'<font color="#ff80aa">       &#9679;&nbsp;  </font>',Intake:'<font color="Black">        &#9679;&nbsp;  </font>',Discovering:'<font color="Orange">      &#9679;&nbsp;  </font>',Delivering:'<font color="Blue">        &#9679;&nbsp;  </font>',"Value Realization":'<font color="#6600cc">     &#x2714;&nbsp;  </font>',Done:'<font color="darkgreen">   &#x2714;&nbsp;  </font>'},this.report_metrics={"No Entry":0,Intake:0,Discovering:0,Delivering:0,"Value Realization":0,Done:0},this.scope=this.getContext().getProject().Name,this.months=["January","February","March","April","May","June","July","August","September","October","November","December"],this.this_date=new Date,this.nbr_of_look_back_months=3,this._setTimeline(this.this_date,this.nbr_of_look_back_months),this.report_columns_headers=[],this._addTargetDatesToColumnHeader(),this.report_columns_headers_size={},this._initializeColumnsHeadersProperties(),console.log(" >>>>>>>>INIT>>>>>>>>>> "),console.log("Delivery Tiemline Configuration"),console.log("Today is",this.this_date),console.log("How far in the past the report need to go in months ",this.nbr_of_look_back_months),console.log("Report start date  ",this.report_start_date),console.log("Report end date  ",this.report_end_date),console.log("Report legend ",this.legend),console.log("Report metrics",this.report_metrics),console.log("Report scope: ",this.scope),console.log("report_columns_headers",this.report_columns_headers),console.log("report_columns_headers_size",this.report_columns_headers_size),console.log(" >>>>>>>>INIT>>>>>>>>>> ")},_setTimeline:function(t,e){var a=t.getMonth(),o=t.getFullYear(),r=a;this.report_start_date=a<=e?new Date(o-1,12+a-e,1):new Date(o,0,1),r=11===a?18:a>=8&&a<=10?15:12,this.report_end_date=new Date(o,r,0)},_addTargetDatesToColumnHeader:function(){var t=this.report_start_date.getFullYear(),e=this.report_start_date.getMonth(),a=this.report_end_date.getMonth();t<this.report_end_date.getFullYear()&&(a+=12);for(var o=e;o<=a;o++){var r=this._buildColumnName(o,t);this.report_columns_headers.push(r),this.report_columns_headers.push(r+"_tool_tip")}},_buildColumnName:function(t,e){var a=new Date(e,t+1,0);return this._buildColumnNameFromDate(a)},_buildColumnNameFromDate:function(t){if(t<this.report_start_date||t>this.report_end_date)return-1;var e=t.getFullYear(),a=t.getMonth();return this.months[a]+": "+e},_initializeColumnsHeadersProperties:function(){for(var t=0;t<this.report_columns_headers.length;t++){var e=this.report_columns_headers[t];this.report_columns_headers_size[e]=10}},_loadPortfolioData:function(){var t=this;for(var e in t.object_count=0,t.report_metrics)t.report_metrics.hasOwnProperty(e)&&(t.report_metrics[e]=0);t.mbi_data_table=[],t.start_time=(new Date).getTime(),t.mbi=[],t._loadMBI(),t.mbi_orphan=[],t._loadMBIOrphan(),t.bi=[],t._loadBI()},_buildMBIFilters:function(){var t,e=this,a="".concat(e.report_end_date.getFullYear(),"-",e.report_end_date.getMonth()+1,"-",e.report_end_date.getDate()),o=Rally.data.wsapi.Filter.fromQueryString('(PlannedEndDate <= "'.concat(a,'")')),r=Rally.data.wsapi.Filter.fromQueryString('(ActualEndDate  <= "'.concat(a,'")'));t=o.or(r);var i="".concat(e.report_start_date.getFullYear(),"-",e.report_start_date.getMonth()+1,"-",e.report_start_date.getDate()),n=Rally.data.wsapi.Filter.fromQueryString('(PlannedEndDate >= "'.concat(i,'")')),l=Rally.data.wsapi.Filter.fromQueryString('(ActualEndDate  >= "'.concat(i,'")'));if(t=t.and(n.or(l)),void 0!==e.selected_tags&&e.selected_tags.length>0){for(var d=Rally.data.wsapi.Filter.fromQueryString('(Tags.Name  = "'+e.selected_tags[0]+'")'),_=1;_<e.selected_tags.length;_++)d=d.or(Rally.data.wsapi.Filter.fromQueryString('(Tags.Name  = "'+e.selected_tags[_]+'")'));t=t.and(d)}return t},_loadMBI:function(){var t=this,e=t._buildMBIFilters();Ext.create("Rally.data.wsapi.Store",{model:"portfolioitem/MBI",filters:e,autoLoad:!0,limit:1/0,sorters:[{property:"Parent.FormattedID",direction:"DESC"},{property:"ActualEndDate",direction:"DESC"},{property:"PlannedEndDate",direction:"DESC"}],listeners:{load:function(e,a){t.object_count++,t.mbi=a,t._start("MBIs with parent")},scope:t},fetch:["Project","FormattedID","Parent","Name","Milestones","State","PlannedEndDate","PlannedStartDate","ActualEndDate","ActualStartDate","Tags","LeafStoryCount","AcceptedLeafStoryCount","AcceptedLeafStoryPlanEstimateTotal","LeafStoryPlanEstimateTotal","DirectChildrenCount","WSJFScore","PreliminaryEstimateValue","Owner","UnEstimatedLeafStoryCount","Children"]})},_loadMBIOrphan:function(){var t=this,e=t._buildMBIFilters(),a=Rally.data.wsapi.Filter.fromQueryString("(Parent = null)");e=e.and(a),Ext.create("Rally.data.wsapi.Store",{model:"portfolioitem/MBI",filters:e,autoLoad:!0,limit:1/0,sorters:[{property:"ActualEndDate",direction:"DESC"},{property:"PlannedEndDate",direction:"DESC"}],listeners:{load:function(e,a){t.object_count++,t.mbi_orphan=a,t._start("MBI _ orphan")},scope:t},fetch:["Project","FormattedID","Parent","Name","Milestones","State","PlannedEndDate","PlannedStartDate","ActualEndDate","ActualStartDate","Tags","LeafStoryCount","AcceptedLeafStoryCount","AcceptedLeafStoryPlanEstimateTotal","LeafStoryPlanEstimateTotal","DirectChildrenCount","WSJFScore","PreliminaryEstimateValue","Owner","UnEstimatedLeafStoryCount","Children"]})},_loadBI:function(){var t=this,e=Rally.data.wsapi.Filter.fromQueryString("(DirectChildrenCount > 0 )");Ext.create("Rally.data.wsapi.Store",{model:"portfolioitem/BI",autoLoad:!0,filters:e,limit:1/0,sorters:[{property:"FormattedID",direction:"DESC"}],listeners:{load:function(e,a){t.object_count++,t.bi=a,t._start("BIs ")},scope:t},fetch:["Project","FormattedID","Parent","Name","Milestones","State","PlannedEndDate","PlannedStartDate","ActualEndDate","ActualStartDate","Tags","LeafStoryCount","AcceptedLeafStoryCount","AcceptedLeafStoryPlanEstimateTotal","LeafStoryPlanEstimateTotal","DirectChildrenCount","WSJFScore","PreliminaryEstimateValue","Owner","UnEstimatedLeafStoryCount","Children"]})},_get_bi_details:function(t){var e={object:"N/A",name:"N/A",id:"N/A",hyperlink_header:"N/A",metadata:"N/A",DirectChildrenCount:"N/A"};if(t&&null!==t.Parent){var a=t.Parent;e.object=a,e.name=a.Name,e.id=a.FormattedID,e.hyperlink_header=this._buildHyperlinkHeader(a),e.metadata=this._buildMyMetaData(a),e.DirectChildrenCount=a.DirectChildrenCount}return e},_get_program_details:function(t,e){var a={object:"N/A",name:"N/A",id:"N/A",hyperlink_header:"N/A",metadata:"N/A",DirectChildrenCount:"N/A"};if(t&&null!==t.Parent){var o=binarySearch(this.bi,"FormattedID",e);if(-1!==o&&null!==this.bi[o].raw.Parent){var r=this.bi[o].raw.Parent;a.object=r,a.name=r.Name,a.id=r.FormattedID,a.hyperlink_header=this._buildHyperlinkHeader(r),a.metadata=this._buildMyMetaData(r),a.DirectChildrenCount=r.DirectChildrenCount}else this.orphan_bi_count++}return a},_get_mbi_details:function(t,e,a){var o={object:"N/A",Name:"N/A",id:"N/A",hyperlink_header:"N/A",metadata:"N/A",State:"N/A",completion_date:"N/A",DirectChildrenCount:"N/A",completion_date_source:"N/A",mbi_column_header:"N/A",mbi_tool_tip_column_header:"N/A",batch_index:a,mbi_index:e};return o.object=t,null!==t.State?o.State=t.State.Name:o.State="No Entry",o.Name=t.Name,o.id=t.FormattedID,o.hyperlink_header=this.legend[o.State]+this._buildHyperlinkHeader(t),o.metadata=this._buildMyMetaData(t),o.DirectChildrenCount=t.DirectChildrenCount,t.ActualEndDate?(o.completion_date=convertCADateZ(t.ActualEndDate),o.completion_date_source="ActualEndDate"):(o.completion_date=convertCADateZ(t.PlannedEndDate),o.completion_date_source="PlannedEndDate"),o.mbi_column_header=this._buildColumnNameFromDate(o.completion_date),o.mbi_tool_tip_column_header=o.mbi_column_header+"_tool_tip",o},_build_mbi_data_table_record:function(t,e,a){for(var o=[],r=0;r<this.report_columns_headers.length;r++)o[this.report_columns_headers[r]]="";return o.Program=a.hyperlink_header,o.Program_tool_tip=a.metadata,o["Business Increment"]=e.hyperlink_header,o["Business Increment_tool_tip"]=e.metadata,o[t.mbi_column_header]=t.hyperlink_header,o[t.mbi_tool_tip_column_header]=t.metadata,o},_update_metrics_count:function(t){this.report_metrics[t.State]++},_insertRecordtoBatch:function(t,e,a){for(var o=!1,r=0;r<t.length&&!o;r++)0===t[r][a.mbi_column_header].length&&(t[r][a.mbi_column_header]=a.hyperlink_header,t[r][a.mbi_tool_tip_column_header]=a.metadata,o=!0);return o||t.push(e),t},_addMbisBatchToDataTableReport:function(t){for(var e=0;e<t.length;e++)this.mbi_data_table.push(t[e])},_start:function(t){var e=this;if(e.setLoading(!1),console.log("done loading:",t),3===e.object_count){var a=e.mbi.length+e.mbi_orphan.length;e.setLoading("Processing "+a+" MBIs. Please wait ..."),console.log("All BI ",e.bi),console.log("MBI with parent BIs ",e.mbi),console.log("Orphan MBIs ",e.mbi_orphan);var o,r,i,n,l=[],d=[],_=[],s=0,c=0,m=[],p=[],h=[];e.orphan_bi_count=0;for(var u=0;u<e.mbi.length;u++){for(n=e.mbi[u].raw,r=e._get_bi_details(n),o=e._get_program_details(n,r.id),s=0,d=[],h=[];u<e.mbi.length&&e.mbi[u].raw.Parent.FormattedID===r.id;)n=e.mbi[u].raw,-1!==(i=e._get_mbi_details(n,u,c)).mbi_column_header?(s++,d.push(i.id),e._update_metrics_count(i),m.push(i),p=e._build_mbi_data_table_record(i,r,o),h=e._insertRecordtoBatch(h,p,i)):_.push(i.id),u++;e._addMbisBatchToDataTableReport(h),u--,l.push({"BI Batch index":c,"BI id":r.id,BI:r,batch_size:s,"program id":o.id,"program ":o,mbis_in_batch:d}),c++}for(s=0,d=[],h=[],u=0,r=e._get_bi_details(!1),o=e._get_program_details(!1,"");u<e.mbi_orphan.length;)n=e.mbi_orphan[u].raw,-1!==(i=e._get_mbi_details(n,u,-1)).completion_date?(s++,d.push(i.id),e._update_metrics_count(i),m.push(i),p=e._build_mbi_data_table_record(i,r,o),h=e._insertRecordtoBatch(h,p,i)):_.push(i.id),u++;e._addMbisBatchToDataTableReport(h),l.push({orphan_batch_size:s,mbis_in_batch:d}),e.orphan_mbi_count=s,l.push({mbis_ignored:_}),console.log("audit_batches processed",l),console.log("audit_mbis processed",m),console.log("MBI Data Table",e.mbi_data_table),e._buildGridNew(),e.setLoading(!1);var g=((new Date).getTime()-e.start_time)/1e3;console.log("Program done execution in: ",g)}else e.setLoading("done loading "+t+" Please wait ...")},_buildMyMetaData:function(t){var e="";e=(e="".concat('<b> <font color="#ccffff">',t.FormattedID,"</b> </font>: ",t.Name,"<br>")).concat(" ------ % Done ------------ ","<br>");var a=0;0!==t.LeafStoryPlanEstimateTotal&&(a=(t.AcceptedLeafStoryPlanEstimateTotal/t.LeafStoryPlanEstimateTotal*100).toFixed(0)),e=e.concat(a,"%  ",t.AcceptedLeafStoryPlanEstimateTotal," of ",t.LeafStoryPlanEstimateTotal," Points Accepted","<br>");var o=0;return 0!==t.LeafStoryCount&&(o=(t.AcceptedLeafStoryCount/t.LeafStoryCount*100).toFixed(0)),e=(e=e.concat(o,"%  ",t.AcceptedLeafStoryCount," of ",t.LeafStoryCount," User Stories Accepted","<br>")).concat(" -------------------------- ","<br>"),t.UnEstimatedLeafStoryCount>0&&(e=e.concat("&#10071; ","Missing Estimates: ",t.UnEstimatedLeafStoryCount," User Stories","<br>")),null===t.PlannedEndDate&&(e=e.concat("&#10071; ","Missing Planned End Date","<br>")),e},_buildHyperlinkHeader:function(t){var e=t.FormattedID,a=t.Name,o="".concat("https://rally1.rallydev.com/#/search?keywords=",e);return"".concat('<a href="',o,'" target="_blank" >',e,"</a>",": ",a,"<br>")},_buildGridNew:function(){var t=this;t.my_grid&&t.my_grid.destroy();for(var e=["Program","Business Increment"],a=0;a<t.report_columns_headers.length;a++)-1===t.report_columns_headers[a].indexOf("tool_tip")&&e.push(t.report_columns_headers[a]);console.log("report_column_header",e);var o=[];for(a=0;a<e.length;a++)o.push({text:e[a],dataIndex:e[a],width:100});var r=t.mbi_data_table;t.ds=Ext.create("Ext.data.Store",{storeId:"dataTableStore",fields:e,data:r,groupField:"Program",groupDir:"ASC"}),t.my_grid=Ext.create("Ext.grid.Panel",{id:"my_grid",title:"MBI Delivery Timeline",store:t.ds,columns:o,columnLines:!0,sortableColumns:!0,height:1100,width:"100%",maxHeight:"100%",tbar:[{xtype:"label",html:t._buildGridLegend()}],forceFit:!0,renderTo:Ext.getBody(),features:[{ftype:"groupingsummary",groupHeaderTpl:"{name} ({rows.length})"}]});var i=t._buildColumnNameFromDate(t.this_date),n=searchKeyPair(t.my_grid.columns,"text",i);if(-1!==n)for(a=2;a<t.my_grid.columns.length;a++)(a<n-1||a>n+4)&&t.my_grid.columns[a].setVisible(!1);t.add(t.my_grid),t._addToolTip(t.my_grid),(t.isChrome||t.isFirefox)&&(t.exportBtn_added||t._addCSVExport_Btn()),(t.isChrome||t.isFirefox||t.isIE)&&(t.printtBtn_added||t._print())},_buildGridLegend:function(){var t=this,e=" | ",a=0;for(var o in t.legend)t.legend.hasOwnProperty(o)&&(a+=t.report_metrics[o],e=e+t.legend[o]+" "+o+": "+t.report_metrics[o]+" | ");if(e=(e=(e="(<b>"+a+" </b>)"+e)+"<u> Orphan MBIs: "+t.orphan_mbi_count+"</u> | ")+"<u> Orphan BIs: "+t.orphan_bi_count+"</u>",void 0!==t.selected_tags&&t.selected_tags.length>0){e+="<br><br> <i>Filtered by tag(s):</i>  ";for(var r=0;r<t.selected_tags.length;r++)e+='<font color="red"> '+t.selected_tags[r]+"</font> | "}return e},_buildGridOld:function(){Ext.create("Ext.data.Store",{storeId:"dataTableStore",fields:["Program","BI","05/2018","06/2018"],data:[{Program:"Program 1",Program_tool_tip:"&#33;    P1_Meta",BI:"BI 1",BI_tool_tip:"BI_1_Meta","05/2018":"MBI 1","05/2018_tool_tip":" MBI 1 _ meta","06/2018":"MBI 9","06/2018_tool_tip":" MBI 9 _ meta"},{Program:"Program 1",Program_tool_tip:"&#10071; P1_Meta",BI:"BI 1",BI_tool_tip:"BI_1_Meta","05/2018":"MBI 2","05/2018_tool_tip":" MBI 2 _ meta","06/2018":"MBI 10","06/2018_tool_tip":" MBI 10 _ meta"},{Program:"Program 1",Program_tool_tip:"&#10060; P1_Meta",BI:"BI 1",BI_tool_tip:"BI_1_Meta","05/2018":"MBI 3","05/2018_tool_tip":" MBI 3 _ meta","06/2018":"MBI 11","06/2018_tool_tip":" MBI 11 _ meta"},{Program:"Program 1",Program_tool_tip:"&#9989;  P1_Meta",BI:"BI 2",BI_tool_tip:"BI_2_Meta","05/2018":"MBI 4","05/2018_tool_tip":" MBI 4 _ meta","06/2018":"MBI 12","06/2018_tool_tip":" MBI 12 _ meta"},{Program:"Program 1",Program_tool_tip:"P1_Meta",BI:"BI 2",BI_tool_tip:"BI_2_Meta","05/2018":"MBI 5","05/2018_tool_tip":" MBI 5 _ meta","06/2018":"MBI 13","06/2018_tool_tip":" MBI 13 _ meta"},{Program:"Program 1",Program_tool_tip:"P1_Meta",BI:"BI 2",BI_tool_tip:"BI_2_Meta","05/2018":"MBI 6","05/2018_tool_tip":" MBI 6 _ meta","06/2018":"MBI 14","06/2018_tool_tip":" MBI 14 _ meta"},{Program:"Program 1",Program_tool_tip:"P1_Meta",BI:"BI 3",BI_tool_tip:"BI_3_Meta","05/2018":"MBI 7","05/2018_tool_tip":" MBI 7 _ meta","06/2018":"MBI 15","06/2018_tool_tip":" MBI 15 _ meta"},{Program:"Program 1",Program_tool_tip:"P1_Meta",BI:"BI 3",BI_tool_tip:"BI_3_Meta","05/2018":"MBI 8","05/2018_tool_tip":" MBI 8 _ meta","06/2018":"MBI 16","06/2018_tool_tip":" MBI 16 _ meta"},{Program:"Program 2",Program_tool_tip:"P2_Meta",BI:"BI 4",BI_tool_tip:"BI_4_Meta","05/2018":"MBI 33","05/2018_tool_tip":" MBI 33 _ meta","06/2018":"MBI 41","06/2018_tool_tip":" MBI 41 _ meta"},{Program:"Program 2",Program_tool_tip:"P2_Meta",BI:"BI 4",BI_tool_tip:"BI_4_Meta","05/2018":"MBI 34","05/2018_tool_tip":" MBI 34 _ meta","06/2018":"MBI 42","06/2018_tool_tip":" MBI 42 _ meta"},{Program:"Program 2",Program_tool_tip:"P2_Meta",BI:"BI 4",BI_tool_tip:"BI_4_Meta","05/2018":"MBI 35","05/2018_tool_tip":" MBI 35 _ meta","06/2018":"MBI 43","06/2018_tool_tip":" MBI 43 _ meta"},{Program:"Program 2",Program_tool_tip:"P2_Meta",BI:"BI 5",BI_tool_tip:"BI_5_Meta","05/2018":"MBI 36","05/2018_tool_tip":" MBI 36 _ meta","06/2018":"MBI 44","06/2018_tool_tip":" MBI 44 _ meta"},{Program:"Program 2",Program_tool_tip:"P2_Meta",BI:"BI 5",BI_tool_tip:"BI_5_Meta","05/2018":"MBI 37","05/2018_tool_tip":" MBI 37 _ meta","06/2018":"MBI 45","06/2018_tool_tip":" MBI 45 _ meta"},{Program:"Program 2",Program_tool_tip:"P2_Meta",BI:"BI 5",BI_tool_tip:"BI_5_Meta","05/2018":"MBI 38","05/2018_tool_tip":" MBI 38 _ meta","06/2018":"MBI 46","06/2018_tool_tip":" MBI 46 _ meta"},{Program:"Program 2",Program_tool_tip:"P2_Meta",BI:"BI 6",BI_tool_tip:"BI_6_Meta","05/2018":"MBI 39","05/2018_tool_tip":" MBI 39 _ meta","06/2018":"MBI 47","06/2018_tool_tip":" MBI 47 _ meta"},{Program:"Program 2",Program_tool_tip:"P2_Meta",BI:"BI 6",BI_tool_tip:"BI_6_Meta","05/2018":"MBI 40","05/2018_tool_tip":" MBI 40 _ meta","06/2018":"MBI 48","06/2018_tool_tip":" MBI 48 _ meta"}],groupField:"Program",groupDir:"ASC"}),this.my_grid=Ext.create("Ext.grid.Panel",{title:"MBI Delivery Timeline",store:Ext.data.StoreManager.lookup("dataTableStore"),columns:[{text:"Program",dataIndex:"Program"},{text:"BI",dataIndex:"BI"},{text:"05/2018",dataIndex:"05/2018"},{text:"06/2018",dataIndex:"06/2018"}],width:400,forceFit:!0,renderTo:Ext.getBody(),features:[{ftype:"groupingsummary",groupHeaderTpl:"{name} ({rows.length})"}]}),this.add(this.my_grid),this._addToolTip(this.my_grid),this._addCSVExport_Btn(["Program","BI","05/2018","06/2018"]),this._print()},_loadTagChooser:function(){var t={xtype:"rallytagpicker",itemId:"tag-picker-id",alwaysExpanded:!1,autoExpand:!1,fieldLabel:"Tags",labelWidth:100,labelAlign:"right",width:300,storeConfig:{sorters:[{property:"Name",direction:"ASC"}],filters:[{property:"Archived",value:!1}]},listeners:{scope:this,selectionchange:this._getSelectedTagsValues}};this.down("#myContainer-id").add(t)},_getSelectedTagsValues:function(){var t=this.down("#tag-picker-id").getValue();this.selected_tags=[];for(var e=0;e<t.length;e++)this.selected_tags.push(t[e].data.Name);console.log("tags ",this.selected_tags),this._loadPortfolioData()},_addToolTip:function(t){var e=t.getView();Ext.create("Ext.tip.ToolTip",{target:e.el,delegate:e.cellSelector,trackMouse:!0,renderTo:Ext.getBody(),listeners:{beforeshow:function(t){var a=e.getGridColumns()[t.triggerElement.cellIndex],o=e.getRecord(t.triggerElement.parentNode),r=a.dataIndex;r+="_tool_tip";var i=o.raw[r];t.update(i)}}})},_addCSVExport_Btn:function(){var t=this,e=Ext.create("Ext.Button",{text:"Export to CSV",margin:"0 20 0 20",renderTo:Ext.getBody(),handler:function(){t._exportToCSV()}});t.exportBtn_added=!0,t.down("#myContainer-id").add(e)},_exportToCSV:function(){for(var t=this.my_grid.getView(),e=this.my_grid.headerCt.gridVisibleColumns,a="",o=0;o<e.length;o++)a+=e[o].text+",";a+="\n";var r=t.dataSource.data.items;for(o=0;o<r.length;o++){for(var i=r[o].data,n=0;n<e.length;n++){var l=this._escapeForCSV(i[e[n].text]);a+='"'+(l=this._stripHTMLelement(l))+'",'}a+="\n"}window.location="data:text/csv;charset=utf8,"+encodeURIComponent(a)},_escapeForCSV:function(t){return t.match(/,/)&&(t=t.match(/"/)?t.replace(/,/g,""):'"'+t+'"'),t},_stripHTMLelement:function(t){var e=t.toString(),a=(e=(e=e.replace(/<[^>]*>/g,"")).trim()).indexOf("&#x"),o="";return 0===a&&(o=e.substring(a,a+14),e=e.replace(o,"")),0===(a=e.indexOf("&#"))&&(o=e.substring(a,a+13),e=e.replace(o,"")),e=e.trim()},_print:function(){var t=this,e=Ext.create("Ext.Button",{text:"Print",renderTo:Ext.getBody(),handler:function(){t._printing()}});t.printtBtn_added=!0,t.down("#myContainer-id").add(e)},_printing:function(){var t=this.my_grid.getView().store.data.items,e=this.my_grid.headerCt.gridVisibleColumns,a=window.open(),o=new Date,r='<style type="text/css">';r+="div.div1 { background-color: #cce6ff; font-size: small;}",r+="@media print { thead {display: table-header-group;}}",this.isIE?r+="table, th, td  {border-collapse:collapse; border: 1px solid lightgrey; font-style: normal;}":r+="table, th, td  {border-collapse:collapse; border: 1px solid lightgrey; font-style: normal; font-size: 15%;}",r+="tr.d0 td { background-color: white; color: black;}",r+="tr.d1 td { background-color: #f0f0f0; color: black;}",r+="</style>";var i="MBI Delivery Timeline: "+this.scope,n=" <!DOCTYPE html> ";n+="<body> ",n+="<head> ",n+="<title> Printable "+i+"</title>",n+='<div id="todayDate">'+Ext.Date.format(o,"F j, Y, g:i a")+"</div>",n+='<div id="header"> '+i+" </div> <br>",n+='<div id="legend"; class ="div1" >'+this._buildGridLegend()+" </div>",n+="</head>",n+="<table >",n+='<width="100%">',n+=" <thead>",n+="<tr>";for(var l=0;l<e.length;l++)n+="<th>"+e[l].text+"</th>";n+="</tr>  </thead>";for(var d=0;d<t.length;d++){for(n+=d%2==0?'<tr class= "d0">':'<tr class= "d1">',l=0;l<e.length;l++)n+="<td>"+t[d].data[e[l].text]+"</td>";n+="</tr>"}n+="</table>",n+="</body> ",n+="</html> ",a.document.write(r),a.document.write(n),a.document.close(),a.focus(),a.print(),a.close()},_addFilterByState:function(){this.filter_by_state=!0;var t={xtype:"rallyfieldvaluecombobox",itemId:"state-picker-id",model:"PortfolioItem/MBI",field:"State",fieldLabel:"State",labelAlign:"right",width:300,multiSelect:!1,listeners:{scope:this,select:this._getSelectedStateValues}};this.down("#myContainer-id").add(t)},_getSelectedStateValues:function(){this.selected_state=this.down("#state-picker-id").getValue(),console.log("State ",this.selected_state)}});

            Rally.launchApp('CustomApp', {
                name:"delivery_timeline_ent",
                parentRepos:"",
                version:"0.1.1"
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
